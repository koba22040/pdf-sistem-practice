# PDF入力支援システム

このプロジェクトは、既存のPDFファイル上にウェブフォームのような入力フィールドを視覚的に配置し、Googleフォームと連携してPDFを自動生成するための、高機能な入力支援システムです。

## 概要

本システムは、主に2つの部分から構成されています。

1.  **PDFテンプレートエディタ (ブラウザで動作)**
    PDFを背景として読み込み、テキストボックス、文章欄、選択肢（チェックボックス・ラジオボタン）などの入力フィールドをGUIで自由に配置できます。作成したレイアウトは、関連ファイルと共にZIPキットとして出力され、後述のGoogle Apps Scriptでの展開を容易にします。

2.  **Google Apps Script (GAS) バックエンド**
    エディタで作成したキットを利用して、Googleフォームの回答をトリガーに、入力内容をPDFへ自動的に描画します。生成されたPDFはGoogleドライブに保存され、必要に応じて回答者へメールで自動送信されます。

---

## 主な機能

### PDFテンプレートエディタ

-   **PDFの読み込み**: 背景となるPDFファイルをドラッグ＆ドロップまたはファイル選択で読み込みます。
-   **フィールド配置**: テキスト、文章欄、丸囲み(○)、チェック(✓)マークをキャンバス上にクリック＆ドラッグで配置・リサイズできます。
-   **豊富なグループ化機能**:
    -   **日付グループ**: 年・月・日のフィールドを連携させ、カレンダー入力に対応します。
    -   **電話番号グループ**: ハイフンを含む電話番号を3つのフィールドに自動分割します。
    -   **文字分割グループ**: フリガナのようなマス目入力のため、1文字ずつフィールドに割り振ります。
    -   **共通項目グループ**: 「氏名」など、複数の箇所に同じ内容を一度の入力で反映させます。
-   **自動入力ルール**: 「学籍番号の先頭が1なら工学部」のように、ある項目の入力値に基づいて別の項目の値を自動で決定するルールを設定できます。
-   **入力プレビュー**: 配置したフィールドに実際にデータを入力し、どのように表示されるかリアルタイムで確認できます。
-   **クライアントサイドPDF生成**: バックエンドにデプロイする前に、ブラウザ上だけで入力内容を反映したPDFをプレビュー・生成できます。
-   **テンプレート保存＆読込**: 作成したフィールドのレイアウトをJSONファイルとして保存・読み込みできます。
-   **セットアップキットの出力**: Googleドライブでの設定に必要なファイル（PDF、設定JSON、フォント、GASコード）を一つのZIPファイルにまとめてダウンロードできます。

### Google Apps Script バックエンド

-   **フォーム自動作成**: 設定JSONを元に、Googleフォームを自動で作成します。
-   **PDF自動生成**: Googleフォームの回答時、トリガーによって`onFormSubmit`関数が実行され、回答内容が描画されたPDFを生成します。
-   **Googleドライブ連携**: テンプレートファイルやフォントをGoogleドライブから読み込み、完成したPDFを指定のフォルダに保存します。
-   **メール自動送信**: PDF生成後、フォームで収集したメールアドレス宛に、完成したPDFを添付して自動でメールを送信します（設定でON/OFF可能）。

---

## 技術スタック

-   **フロントエンド**:
    -   HTML5, CSS3, JavaScript (ES6 Modules)
    -   [pdf.js](https://mozilla.github.io/pdf.js/): PDFのレンダリング
    -   [pdf-lib](https://pdf-lib.js.org/): クライアントサイドでのPDF生成
    -   [fontkit](https://github.com/foliojs/fontkit): PDFへのフォント埋め込み
    -   [JSZip](https://stuk.github.io/jszip/): セットアップキット（ZIPファイル）の作成
    -   [flatpickr](https://flatpickr.js.org/): 日付選択カレンダー
-   **バックエンド**:
    -   Google Apps Script
    -   [PDFApp (GAS Library)](https://github.com/tanaikech/PDFApp): GAS上での高度なPDF操作

---

## 使い方とデプロイ

### 1. テンプレートの作成

1.  `index.html`をブラウザで開きます。
2.  システムに背景としたいPDFファイルをドラッグ＆ドロップします。
3.  ツールバーのボタンを使い、必要な入力フィールドをキャンバス上に配置・調整します。
4.  「テンプレート保存」ボタンを押し、設定用のZIPファイルをダウンロードします。

### 2. Google環境へのデプロイ

1.  「テンプレート保存」後に表示されるセットアップウィザードの指示に従います。
2.  ダウンロードしたZIP内のファイル（PDF, JSON, フォント）をGoogleドライブの同じフォルダにアップロードします。
3.  各ファイルの共有リンクと、完成PDFの保存先フォルダのリンクをウィザードに貼り付けます。
4.  ウィザードが生成するGASコードをコピーし、Google Apps Scriptのプロジェクトに貼り付けて実行・設定します。
    -   `setup.js`のコードでGoogleフォームを自動作成します。
    -   作成されたフォームのスクリプトエディタに`main.js`と`PDFApp.js`のコードを導入し、トリガーを設定します。

これにより、作成されたGoogleフォームに回答が送信されるたびに、自動でPDFが生成されるようになります。
